### mysql 学习笔记

#### 登陆mysql 

`cmd --> mysql -u账号  -p密码`

`cmd --> mysq -h地址 -u账号 -p密码`

#### 退出mysql

`exit`

#### sql语句分类

1. DDL
   - 用于定义数据库对象 :数据库,表,列
   
   - 关键字 : create drop alter等
2. DML
   - 用于对数据库中的表进行数据增删改
   
   - 关键字 : insert delete update等
3. DQL
   - 用于查询数据库中的表的数据
   
   - 关键字 : select  where
4. DCL
   - 用于定义数据库的访问权限和安全级别和创建用户
   
   - 关键字 : GRANT REVOKE等 

### sql语句书写注意点 

- sql语句可以单行或者多行书写,以分号`(;)`结尾

- 可以使用空格和缩进来增强语句的可读性

- mysql数据库的sql语句不区分大小写, 关键词建议使用大写

### DDL语句常用命令

#### 创建数据库

- 创建数据库 

```sql
CREATE DATABASE 数据库名称 ;
```

-  判断数据库是否存在并且创建数据库  

```sql
CREATE DATBASE IF NOT EXISTS 数据库名称;
```

- 创建数据库并指定字符集

```sql
CREATE DATAVASE 数据库名称 CHARACTER SET 字符集;
```

#### 查看数据库 

- 查看所有的数据库 

```sql
SHOW DATABASES;
```

- 查看某个数据库的定义信息 

```sql
SHOW CREATE DATABASE 数据库名称;
```

#### 修改数据库

- 修改数据库字符集格式 

```sql
ALTER DATABASE 数据库名称 DEFAULT CHARACTER SET 字符集;
```

#### 删除数据库

```sql
DROP DATABASE 数据库名称;
```

#### 使用数据库

- 查看正在使用的数据库 

```sql
SELECT DATABASE();
```

- 使用 / 切换数据库 

```sql
USE 数据库名称;
```

#### 创建表

- 创建语句 

```sql
CREATE TABLE 表名(字段名1 字段类型1,字段名2 字段类型2 ...);
```

- 推荐写法 

``` sql
CREATE TABLE 表名(
字段名1 字段类型1,
字段名2 字段类型2
);
```



#### MySQL数据类型

- bMySQL中的我们常使用的数据类型如下：

| 类型    | 描述                 |
| :------ | :------------------- |
| int     | 整型                 |
| double  | 浮点型               |
| varchar | 字符串型             |
| data    | 日期类型：yyyy-MM-dd |

- 详细的数据类型如下

| 分类             | 类型名称       | 说明                                                         |
| :--------------- | :------------- | :----------------------------------------------------------- |
| 整数类型         | tinyInt        | 很小的整数                                                   |
|                  | smallint       | 小的整数                                                     |
|                  | mediumint      | 中等大小的整数                                               |
|                  | int(integer)   | 普通大小的整数                                               |
| 小数类型         | float          | 单精度浮点数                                                 |
|                  | double         | 双精度浮点数                                                 |
|                  | decimal（m,d） | 压缩严格的定点数                                             |
| 日期类型         | year           | YYYY 1901~2155                                               |
|                  | time           | HH:MM:SS -838:59:59~838:59:59                                |
|                  | date           | YYYY-MM-DD 1000-01-01~9999-12-3                              |
|                  | datetime       | YYYY-MM-DD HH:MM:SS 1000-01-01 00:00:00~ 9999-12-31 23:59:59 |
|                  | timestamp      | YYYY-MM-DD HH:MM:SS 19700101 00:00:01 UTC~2038-01-19 03:14:07UTC |
| 文本、二进制类型 | CHAR(M)        | M为0~255之间的整数                                           |
|                  | VARCHAR(M)     | M为0~65535之间的整数                                         |
|                  | TINYBLOB       | 允许长度0~255字节                                            |
|                  | BLOB           | 允许长度0~65535字节                                          |
|                  | MEDIUMBLOB     | 允许长度0~167772150字节                                      |
|                  | LONGBLOB       | 允许长度0~4294967295字节                                     |
|                  | TINYTEXT       | 允许长度0~255字节                                            |
|                  | TEXT           | 允许长度0~65535字节                                          |
|                  | MEDIUMTEXT     | 允许长度0~167772150字节                                      |
|                  | LONGTEXT       | 允许长度0~4294967295字节                                     |
|                  | VARBINARY(M)   | 允许长度0~M个字节的变长字节字符串                            |
|                  | BINARY(M)      | 允许长度0~M个字节的定长字节字符串                            |



####  查看表

-  查看某个数据库中的所有表

```sql
SHOW TABLES;
```

- 查看表结构

```sql
DESC 表名;
```

- 查看创建表的SQL语句

```SQL
SHOW CREATE TABLE 表名;
```



#### 快速创建一个表结构相同的表

```sql
CREATE TABLE 新表名 LIKE 旧表名;
```



#### 删除表

- 直接删除表

```SQL
DROP TABLE 表名;
```

- 判断表是否存在并删除表

```sql
DROP TABLE IF EXISTS 表名;
```



#### 修改表结构

- 添加列类型

```sql
ALTER TABLE 表名 ADD 列名 类型;
```

- 修改列类型

``` sql
ALTER TABLE 表名 MODIUFY 列名 新的类型;
```

- 修改列名

```sql
ALTER TABLE 表名 CHANGE 旧列名 新列名 类型;
```

- 删除列

```sql
ALTER TABLE 表名 DROP 列名;
```

- 修改表名 

```sql
ALTER TABLE 表名 TO 新表名;
```

- 修改字符集

```sql
ALTER TABLE 表名 CHARACTER SET 字符集;
```



### DML常用语句

#### 插入记录

```mysql
INSERT INTO 表名 (字段名称1,字段名称2...) VALUES (值1.值2...);
```

注意点 :

1. 值与字段必须相互对应, 个数对应,类型相同
2. 值的数据大小必须在字段的长度范围内
3. 除了数值类型外,其他的字段类型的值必须使用引号引用起来
4. 如果需要插入空值,要不不写字段名, 要么插入NULL 

#### 插入全部字段

1. 所有的字段名都写出来

```mysql
INSERT INTO 表名 (字段名1, 字段名2, 字段名3…) VALUES (值1, 值2, 值3);
```

2. 不写字段名称

```mysql
INSERT INTO 表名 VALUES (值1,值2,值3...);
```

注意点 :

如果不书写字段, 那么值一定要全部书写, 因为`mysql`会自动补全字段名称

#### 插入部分数据

```mysql
INSERT INTO 表名 VALUES (值1,值2,值3...);
```

注意点:

没有添加数据的字段会自动使用 NULL

#### 蠕虫复制

 什么是蠕虫复制 :在已有的数据基础之上，将原来的数据进行复制，插入到对应的表中

```mysql
INSERT INTO 表名1 SELECT * FROM 表名2;
```

作用:将`表名2`中的数据复制到`表名1`中

注意：如果只想复制`student`表中`name,age`字段数据到`student2`表中使用如下格式

```sql
INSERT INTO student2(name,age) SELECT name,age FROM student;
```

#### 更新表记录

1. 不带条件修改数据

```sql
UPDATE 表名 SET 字段名=值;
```

2. 带条件修改数据

```sql
UPDATE 表名 SET 字段名=值 WHERE 字段名=值;
```

关键字说明

```sql
UPDATE: 修改数据
SET: 修改哪些字段
WHERE: 指定条件
```

#### 删除表记录

1. 不带条件删除数据

```sql
DELETE FROM 表名;
```

2. 带条件删除数据

```sql
DELETE FROM 表名 WHERE 字段名称 = 值;
```

3. TRUNCATE删除表记录

```sql
TRUNCATE TABLE 表名;
```

`TRUNCATE`和`DELETE`的区别

1. `DELETE`是将表中的数据一条一条的删除
2. `TRUNCATE`是将整个表彻底摧毁,重新建立一个新的表, 这个表的结构和原本的表示一模一样的



### DQL常用语句

注意点 : DQL查询语句不会对数据库中的数据进行修改, 只会把数据展现出来

#### 查询表的所有数据

1. 使用`*`表示所有列

```mysql
SELECT * FROM 表名;
```

2. 写出查询每列的名称

```mysql
SELECT 字段名1,字段名2,字段名3... FROM 表名;
```

#### 查询指定列

1. 查询指定列的数据,多个列之间以逗号`(,)`进行分割

```mysql
SELECT 字段名1,字段名2... FROM 表名;
```

#### 别名查询

1. 查询时给列,表,指定别名需要用`AS`关键字
2. 使用别名的好处就是方便观看和处理查询到的数据

```mysql
SELECT 字段名1 AS 别名, 字段名2 AS 别名... FROM 表名;
```

#### 清除重复值

1. 查询指定列并且结果不出现重复数据

```mysql
SELECT DISTINCT 字段名 FROM 表名;
```

#### 查询结果参与运算

1. 某列数据和固定值运算

```mysql
SELECT 列名1 + 固定值 FROM 表名;
```

2. 某列数据和其他列数据参与运算

```mysql
SELECT 列名1 + 列名2 FROM 表名;
```

注意点 : 

1. 参与运算的必须是数值类型 

#### 条件查询

前面我们的查询都是将所有数据都查询出来，但是有时候我们只想获取到`满足条件`的数据

```mysql
SELECT 字段名 FROM 表名 WHERE 条件;
```

流程：取出表中的每条数据，满足条件的记录就返回，不满足条件的记录不返回

#### 比较运算符

`>`大于
`<`小于
`<=`小于等于
`>=`大于等于
`=`等于
`<>`、`!=`不等于

#### 逻辑运算符

`and` 多个条件同时满足
`or` 多个条件其中一个满足
`not` 不满足

####  in关键字

语法格式：

```mysql
SELECT 字段名 FROM 表名 WHERE 字段 in (数据1, 数据2...);
```

`in`里面的每个数据都会作为一次条件，只要满足条件的就会显示

#### 指定查询范围

1. 表示从值1到值2范围，包头又包尾

```mysql
BETWEEN 值1 AND 值2` 
相当于 
age>=35 && age<=70
```

#### like

`LIKE`表示模糊查询

```mysql
SELECT * FROM 表名 WHERE 字段名 LIKE '通配符字符串';
```

作用 : 满足`通配符字符串`规则的数据就会显示出来

MySQL通配符有两个：
`%`: 表示0个或多个字符(任意个字符)
`_`: 表示一个字符

#### 排序

通过`ORDER BY`子句，可以将查询出的结果进行排序(排序只是显示方式，不会影响数据库中数据的顺序)

```mysql
SELECT 字段名 FROM 表名 WHERE 字段=值 ORDER BY 字段名 [ASC|DESC];
```

ASC: 升序, 默认是升序
DESC: 降序

#### 单列排序

单列排序就是使用一个字段排序

#### 组合排序

组合排序就是先按第一个字段进行排序，如果第一个字段相同，才按第二个字段进行排序，依次类推。

```mysql 
SELECT 字段名 FROM 表名 WHERE 字段=值 ORDER BY 字段名1 [ASC|DESC], 字段名2 [ASC|DESC];
```

#### 聚合函数

之前我们做的查询都是横向查询，它们都是根据条件一行一行的进行判断，而使用聚合函数查询是纵向查询，它是对一列的值进行计算，然后返回一个结果值。另外聚合函数会忽略空值

五个聚合函数：
`count`： 统计指定列记录数，记录为NULL的不统计
`sum`： 计算指定列的数值和，如果不是数值类型，那么计算结果为0
`max`： 计算指定列的最大值
`min`： 计算指定列的最小值
`avg`： 计算指定列的平均值，如果不是数值类型，那么计算结果为0

聚合函数的使用：写在 SQL语句`SELECT`后 `字段名`的地方

```mysql
SELECT 字段名... FROM 表名;
```

```mysql
SELECT COUNT(age) FROM 表名;
```

#### 分组

分组查询是指使用 `GROUP BY`语句对查询信息进行分组，`相同数据作为一组`

```mysql
SELECT 字段1,字段2... FROM 表名 GROUP BY 分组字段 [HAVING 条件];
```

GROUP BY怎么分组的？

**将分组字段结果中相同内容作为一组**

注意事项 : 

```
注意事项：当我们使用某个字段分组,在查询的时候也需要将这个字段查询出来,否则看不到数据属于哪组的
```

注意点 : having与where的区别

- having是在分组后对数据进行过滤.
- where是在分组前对数据进行过滤
- having后面可以使用聚合函数
- where后面不可以使用聚合函数

#### limit语句

`LIMIT`是`限制`的意思，所以`LIMIT`的作用就是限制查询记录的条数。

```mysql
SELECT *|字段列表 [as 别名] FROM 表名 [WHERE子句] [GROUP BY子句][HAVING子句][ORDER BY子句][LIMIT子句];
```

思考：limit子句为什么排在最后？
因为前面所有的限制条件都处理完了，只剩下显示多少条记录的问题了！

**LIMIT语法格式**：
`LIMIT offset,length; 或者limit length;`
`offset`是指偏移量，可以认为是跳过的记录数量，默认为0
`length`是指需要显示的总记录数

### 数据库约束

对表中的数据进行进一步的限制，保证数据的**正确性**、**有效性**和**完整性**。
**约束种类**：

- `PRIMARY KEY`: 主键
- `UNIQUE`: 唯一
- `NOT NULL`: 非空
- `DEFAULT`: 默认
- `FOREIGN KEY`: 外键

#### 主键

1. **主键的作用**

    **用来唯一标识一条记录**，每个表都应该有一个主键，并且每个表只能有一个主键。
   有些记录的 name,age,sex 字段的值都一样时,那么就没法区分这些数据,造成数据库的记录不唯一,这样就不方便管理数据

2. **那些字段应该作为表的主键**

   通常不用业务字段作为主键，单独给每张表设计一个id的字段，把id作为主键。主键是给数据库和程序使用的，不是给最终的客户使用的。所以主键有没有含义没有关系，只要不重复，非空就行。

#### 创建主键

主键：`PRIMARY KEY`
**主键的特点**：

- 主键必须包含唯一的值
- 主键列不能包含NULL值

**创建主键方式**：

**在创建表的时候给字段添加主键**

```mysql
字段名 字段类型 PRIMARY KEY
```

#### 删除主键

```mysql
ALTER TABLE 表名 DROP PRIMARY KEY;
```

#### 主键自增

 主键如果让我们自己添加很有可能重复,我们通常希望在每次插入新记录时,数据库自动生成主键字段的值

```mysql
AUTO_INCREMENT   

表示自动增长(字段类型必须是整数类型)
```

#### 唯一

在这张表中这个字段的值不能重复

#### 唯一约束的基本格式

```mysql
字段名 字段类型 UNIQUE
```

#### 非空

这个字段必须设置值,不能是NULL

#### 非空约束的基本语法格式

```mysql
字段名 字段类型 NOT NULL
```

#### 默认值

往表中添加数据时,如果不指定这个字段的数据,就使用默认值

默认值格式

```mysql
字段名 字段类型 DEFAULT 默认值
```